<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Panel Administrador - TECNO TREBOL</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

<style>
body{font-family:Arial;margin:0;background:#f5f5f5;color:#222}
header{background:#8B0000;color:#fff;padding:10px 20px;box-shadow: 0 2px 10px rgba(0,0,0,0.1);}
.header-container{max-width:1200px;margin:auto;display:flex;justify-content:space-between;align-items:center;}
.container{max-width:1200px;margin:auto;padding:20px}
form{background:#fff;padding:25px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.15);max-width:600px;margin:auto;display:none;}
input, textarea, select{width:100%;padding:12px;border:1px solid #bbb;border-radius:8px;margin-top:6px;box-sizing: border-box;}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:20px;margin-top:30px;}
.card{background:#fff;padding:14px;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,0.1);text-align: center;}

/* AJUSTE PARA IMÁGENES 800x800 */
.card img{
  width:100%;
  height:200px;
  object-fit: contain; /* No recorta la imagen */
  background-color: #fff;
  border-radius:8px;
}

#loginOverlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);display:flex;justify-content:center;align-items:center;z-index:1000;}
#loginBox{background:white;padding:30px;border-radius:12px;text-align:center;width:300px;}
.btn-red{background:#8B0000;color:white;border:0;padding:10px;border-radius:6px;cursor:pointer;width:100%;margin-top:10px;font-weight: bold;}
.btn-view-desc{background:#0056b3;color:white;border:0;padding:8px;border-radius:6px;cursor:pointer;width:100%;margin-top:5px;font-size:12px;}
.desc-container{display:none; margin-top:10px; font-size:12px; color:#555; background:#f9f9f9; padding:8px; border-radius:5px; text-align: left;}
.edit-input{margin-bottom: 5px; font-size: 13px; padding: 8px;}
</style>
</head>
<body>

<header>
  <div class="header-container">
    <div class="header-title">Panel Administrador</div>
  </div>
</header>

<div id="loginOverlay">
  <div id="loginBox">
    <h3>Acceso Admin</h3>
    <input type="email" id="correoLogin" placeholder="Correo admin">
    <button class="btn-red" onclick="verificarCorreo()">Entrar</button>
  </div>
</div>

<div class="container">
  <form id="form-producto">
    <h2 style="text-align:center;color:#8B0000;">Agregar nuevo producto</h2>
    <label>Nombre:</label><input id="nombre" required>
    <label>Precio:</label><input id="precio" required>
    <label>Descripción:</label><textarea id="descripcion" rows="2"></textarea>
    <label>URL de Foto:</label><input id="foto" required>
    <button type="submit" class="btn-red">Subir a Firebase</button>
  </form>
  <div id="productos" class="grid"></div>
</div>

<script>
const firebaseConfig = { databaseURL: "https://tecnotrebol-67a34-default-rtdb.firebaseio.com" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const productosRef = db.ref("productos");

function verificarCorreo() {
  if(document.getElementById("correoLogin").value.trim() === "gaboxxlopez28@gmail.com") {
    document.getElementById("loginOverlay").style.display = "none";
    document.getElementById("form-producto").style.display = "block";
    cargarProductos();
  } else { alert("Acceso denegado"); }
}

document.getElementById("form-producto").onsubmit = e => {
  e.preventDefault();
  const nuevo = {
    nombre: document.getElementById("nombre").value,
    precio: document.getElementById("precio").value,
    descripcion: document.getElementById("descripcion").value,
    foto: document.getElementById("foto").value
  };
  productosRef.push(nuevo);
  e.target.reset();
  alert("Producto guardado");
};

function cargarProductos() {
  productosRef.on("value", snapshot => {
    const contenedor = document.getElementById("productos");
    contenedor.innerHTML = "";
    const data = snapshot.val();
    if(data) {
      Object.keys(data).forEach(id => {
        const p = data[id];
        contenedor.innerHTML += `
          <div class="card" id="card-${id}">
            <img src="${p.foto}" id="display-img-${id}">
            <h3 id="display-nombre-${id}">${p.nombre}</h3>
            <p id="display-precio-${id}" style="font-weight:bold; color:#8B0000;">${p.precio}</p>
            <button class="btn-view-desc" onclick="toggleDesc('${id}')">Ver descripción</button>
            <div id="display-desc-${id}" class="desc-container">${p.descripcion || 'Sin descripción'}</div>
            <div id="actions-${id}">
                <button class="btn-red" style="background:#e6a500; margin-bottom:5px;" onclick="habilitarEdicion('${id}')">
                    <i class="fas fa-edit"></i> Editar
                </button>
                <button class="btn-red" style="background:#b30000" onclick="eliminar('${id}')">
                    <i class="fas fa-trash"></i> Eliminar
                </button>
            </div>
          </div>`;
      });
    }
  });
}

function toggleDesc(id) {
    const desc = document.getElementById(`display-desc-${id}`);
    desc.style.display = (desc.style.display === "block") ? "none" : "block";
}

function habilitarEdicion(id) {
    const nombre = document.getElementById(`display-nombre-${id}`).innerText;
    const precio = document.getElementById(`display-precio-${id}`).innerText;
    const desc = document.getElementById(`display-desc-${id}`).innerText;
    const foto = document.getElementById(`display-img-${id}`).src;
    document.getElementById(`card-${id}`).innerHTML = `
        <label style="font-size:11px">Nombre:</label><input type="text" id="edit-nombre-${id}" class="edit-input" value="${nombre}">
        <label style="font-size:11px">Precio:</label><input type="text" id="edit-precio-${id}" class="edit-input" value="${precio}">
        <label style="font-size:11px">Descripción:</label><textarea id="edit-desc-${id}" class="edit-input" rows="3">${desc}</textarea>
        <label style="font-size:11px">URL Imagen:</label><input type="text" id="edit-foto-${id}" class="edit-input" value="${foto}">
        <button class="btn-red" style="background:#28a745" onclick="actualizarProducto('${id}')">Guardar</button>
        <button class="btn-red" style="background:#6c757d" onclick="cargarProductos()">Cancelar</button>`;
}

function actualizarProducto(id) {
    const nuevasFichas = {
        nombre: document.getElementById(`edit-nombre-${id}`).value,
        precio: document.getElementById(`edit-precio-${id}`).value,
        descripcion: document.getElementById(`edit-desc-${id}`).value,
        foto: document.getElementById(`edit-foto-${id}`).value
    };
    db.ref("productos/" + id).update(nuevasFichas).then(() => alert("Actualizado"));
}

function eliminar(id) { if(confirm("¿Borrar?")) db.ref("productos/" + id).remove(); }
</script>
</body>
</html>
